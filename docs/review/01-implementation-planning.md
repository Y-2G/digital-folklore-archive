# 実装計画での重大観点（設計・タスク分解・リリースまで）

## 目的と"守るべき不変条件"が言語化されているか

- 何を達成するのか（ユーザー価値 / 業務価値）
- 絶対に壊してはいけないルール（例：請求金額の計算、権限、課金、監査ログ…）
- 成功条件（受け入れ条件）と、やらないこと（スコープ外）

## 仕様の境界（Edge case）が列挙されているか

- 入力の境界：null/空/最大長/不正値/重複/順序/時刻ズレ/タイムゾーン
- 状態の境界：未作成/途中/キャンセル/再実行/二重送信/並行更新
- "例外系が主役"の領域（決済、請求、認可、同時編集など）は特にここが命

## 失敗時の挙動が決まっているか（壊れ方の設計）

- どこで失敗しうるか（外部API、DB、キュー、ファイル、権限）
- リトライ可否、冪等性、タイムアウト、部分失敗時の補償（ロールバック/補正処理）
- UI/UX：ユーザーに何を見せるか、再操作させるか、ログに残すか

## データ設計と移行の安全性

- 既存データとの整合（後方互換 / 既存レコードの扱い）
- マイグレーション：追加→埋める→切替→削除 の段階設計（Big bangを避ける）
- インデックス、ユニーク制約、外部キー、論理削除、履歴、監査

## リリース戦略（段階リリース/ロールバック/監視）

- Feature Flag / 設定で切替できるか（戻せるか）
- ロールバック手順（DB変更がある場合の現実的な戻し方）
- 監視項目：エラーレート、レイテンシ、重要KPI、ジョブ滞留、DB負荷
- 影響範囲と周知（運用者・CS・QA）

## 性能・コストの見積もり（最悪ケースで死なないか）

- N+1、重いJOIN、全件スキャン、巨大ペイロード、画像/動画、外部API連打
- キャッシュ戦略、ページング、バックグラウンド化
- 想定トラフィック / バッチ時間 / 料金（SaaSだとここが後から刺さる）

## テスト戦略が"仕様のリスク"に沿っているか

- ユニットで守るもの / 結合で守るもの / E2Eで守るもの
- 境界条件と失敗時のテストがあるか
- テストデータの設計（現実データに近いか、再現可能か）
